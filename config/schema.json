{
    "$schema": "http://json-schema.org/draft-07/schema#",
    "title": "Packwatch Application Configuration",
    "description": "Schema for a single application configuration file.",
    "type": "object",
    "properties": {
        "app_key": {
            "type": "string",
            "description": "Unique identifier for the application (e.g., 'Ghostty')."
        },
        "enabled": {
            "type": "boolean",
            "description": "Whether to check this application for updates."
        },
        "application": {
            "type": "object",
            "description": "Contains the specific configuration for the application.",
            "oneOf": [
                { "$ref": "#/definitions/appimage" },
                { "$ref": "#/definitions/custom" },
                { "$ref": "#/definitions/direct_deb" },
                { "$ref": "#/definitions/github_deb" },
                { "$ref": "#/definitions/github_tgz" },
                { "$ref": "#/definitions/script" }
            ]
        }
    },
    "required": ["app_key", "enabled", "application"],
    "definitions": {
        "common_properties": {
            "type": "object",
            "properties": {
                "name": { "type": "string" },
                "checksum_url": { "type": "string", "format": "uri" },
                "checksum_algorithm": { "type": "string", "enum": ["sha256", "sha512"] },
                "sig_url": { "type": "string", "format": "uri" },
                "gpg_key_id": { "type": "string" },
                "gpg_fingerprint": { "type": "string" },
                "allow_insecure_http": { "type": "boolean" }
            }
        },
        "appimage": {
            "type": "object",
            "properties": {
                "type": { "const": "appimage" },
                "download_url": { "type": "string", "format": "uri" },
                "install_path": { "type": "string" }
            },
            "required": ["type", "name", "download_url", "install_path"],
            "allOf": [{ "$ref": "#/definitions/common_properties" }]
        },
        "custom": {
            "type": "object",
            "properties": {
                "type": { "const": "custom" },
                "custom_checker_script": { "type": "string" },
                "custom_checker_func": { "type": "string" }
            },
            "required": ["type", "name", "custom_checker_script", "custom_checker_func"],
            "allOf": [{ "$ref": "#/definitions/common_properties" }]
        },
        "direct_deb": {
            "type": "object",
            "properties": {
                "type": { "const": "direct_deb" },
                "download_url": { "type": "string", "format": "uri" },
                "package_name": { "type": "string" }
            },
            "required": ["type", "name", "download_url", "package_name"],
            "allOf": [{ "$ref": "#/definitions/common_properties" }]
        },
        "github_deb": {
            "type": "object",
            "properties": {
                "type": { "const": "github_deb" },
                "package_name": { "type": "string" },
                "repo_owner": { "type": "string" },
                "repo_name": { "type": "string" },
                "filename_pattern_template": { "type": "string" }
            },
            "required": ["type", "name", "package_name", "repo_owner", "repo_name", "filename_pattern_template"],
            "allOf": [{ "$ref": "#/definitions/common_properties" }]
        },
        "github_tgz": {
            "type": "object",
            "properties": {
                "type": { "const": "github_tgz" },
                "repo_owner": { "type": "string" },
                "repo_name": { "type": "string" },
                "filename_pattern_template": { "type": "string" }
            },
            "required": ["type", "name", "repo_owner", "repo_name", "filename_pattern_template"],
            "allOf": [{ "$ref": "#/definitions/common_properties" }]
        },
        "script": {
            "type": "object",
            "properties": {
                "type": { "const": "script" },
                "download_url": { "type": "string", "format": "uri" },
                "version_url": { "type": "string", "format": "uri" },
                "version_regex": { "type": "string" }
            },
            "required": ["type", "name", "download_url", "version_url", "version_regex"],
            "allOf": [{ "$ref": "#/definitions/common_properties" }]
        }
    }
}
